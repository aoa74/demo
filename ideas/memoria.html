<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memomatch: Desaf√≠o Visual</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #e1bee7);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    h1 {
      margin-top: 10px;
    }
    #instructions {
      margin: 10px 20px;
      max-width: 500px;
      font-size: 14px;
      background: #fff3e0;
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(4, 60px);
      grid-gap: 10px;
      margin: 20px 0;
    }
    .cell {
      width: 60px;
      height: 60px;
      background-color: #ccc;
      border-radius: 10px;
      transition: background-color 0.3s;
      cursor: pointer;
    }
    .highlight {
      background-color: #ffeb3b !important;
    }
    #score, #message, #timer, #level {
      margin: 8px;
    }
    button {
      padding: 10px 20px;
      border: none;
      background-color: #7e57c2;
      color: white;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #5e35b1;
    }
    #modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      text-align: center;
      z-index: 999;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Memomatch: Desaf√≠o Visual</h1>
  <div id="instructions">
    En cada ronda ver√°s brillar ciertos cuadros. Memor√≠zalos y haz clic solo en los que brillaron. <br>
    Cada ronda ser√° m√°s desafiante ¬°Completa los 5 niveles!
  </div>
  <div id="level">Nivel: 1</div>
  <div id="score">Puntaje: 0</div>
  <div id="timer">Tiempo: 30s</div>
  <div id="grid"></div>
  <div id="message"></div>
  <button onclick="startGame()">üéÆ Iniciar juego</button>

  <div id="modal"></div>

  <script>
    const grid = document.getElementById("grid");
    const scoreDisplay = document.getElementById("score");
    const timerDisplay = document.getElementById("timer");
    const message = document.getElementById("message");
    const levelDisplay = document.getElementById("level");
    const modal = document.getElementById("modal");

    let level = 1;
    let score = 0;
    let highlightCount = 3;
    let highlighted = [];
    let userClicks = [];
    let timer;
    let timeLeft = 30;

    function createGrid(size = 16) {
      grid.innerHTML = "";
      for (let i = 0; i < size; i++) {
        const div = document.createElement("div");
        div.classList.add("cell");
        div.dataset.index = i;
        div.addEventListener("click", handleClick);
        grid.appendChild(div);
      }
    }

    function handleClick(e) {
      const index = parseInt(e.target.dataset.index);
      if (userClicks.includes(index)) return;
      userClicks.push(index);

      if (highlighted.includes(index)) {
        e.target.style.backgroundColor = "#81c784"; // verde
      } else {
        e.target.style.backgroundColor = "#e57373"; // rojo
        endGame("‚ùå ¬°Fallaste! Perdiste el nivel.");
        return;
      }

      if (userClicks.length === highlighted.length) {
        endRound();
      }
    }

    function startGame() {
      level = 1;
      score = 0;
      hideModal();
      updateDisplays();
      nextLevel();
    }

    function updateDisplays() {
      scoreDisplay.textContent = `Puntaje: ${score}`;
      levelDisplay.textContent = `Nivel: ${level}`;
    }

    function nextLevel() {
      if (level > 5) {
        const best = Math.max(score, parseInt(localStorage.getItem("bestScore") || "0"));
        localStorage.setItem("bestScore", best);
        showModal(`üéâ Juego terminado. Puntaje final: ${score}<br>üèÜ Mejor puntaje: ${best}`);
        return;
      }

      userClicks = [];
      highlighted = [];
      timeLeft = 30;
      message.textContent = "";
      updateDisplays();
      createGrid();

      const cells = Array.from(document.querySelectorAll(".cell"));
      while (highlighted.length < highlightCount + level - 1) {
        const rand = Math.floor(Math.random() * cells.length);
        if (!highlighted.includes(rand)) highlighted.push(rand);
      }

      highlighted.forEach(i => {
        cells[i].classList.add("highlight");
      });

      setTimeout(() => {
        cells.forEach(cell => cell.classList.remove("highlight"));
        startTimer();
      }, 2000);
    }

    function startTimer() {
      clearInterval(timer);
      timerDisplay.textContent = `Tiempo: ${timeLeft}s`;
      timer = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `Tiempo: ${timeLeft}s`;
        if (timeLeft === 0) {
          clearInterval(timer);
          endGame("‚è∞ Tiempo agotado. Perdiste el nivel.");
        }
      }, 1000);
    }

    function endRound() {
      clearInterval(timer);
      const correct = userClicks.filter(i => highlighted.includes(i)).length;
      const total = highlighted.length;
      const roundScore = Math.round((correct / total) * 100);
      score += roundScore;
      level++;
      updateDisplays();
      setTimeout(nextLevel, 1500);
    }

    function endGame(messageText) {
      clearInterval(timer);
      showModal(`${messageText}<br>üîÅ Intenta de nuevo.`);
    }

    function showModal(content) {
      modal.innerHTML = content + '<br><br><button onclick="startGame()">üîÅ Reiniciar</button>';
      modal.style.display = "block";
    }

    function hideModal() {
      modal.style.display = "none";
    }
  </script>
</body>
</html>
